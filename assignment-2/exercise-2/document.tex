% !TEX root = ./document.tex

\documentclass[a4paper, spanish]{article}

\usepackage{mystyle}
\usepackage{myvars}

\begin{document}

  \maketitle

  \begin{itemize}
    \item \textbf{Archivo}: \texttt{tuberculo.sf3}
    \item \textbf{Serie}: Número de casos registrados semanalmente de tuberculosis respiratoria en España, entre los años $1982$ y $1991$ (el primer dato corresponde al número de casos registrados desde el \emph{$1$ de Enero de $1982$} al \emph{$7$ de Enero de $1982$}).
    \begin{itemize}
      \item $\{X_t\}$ Serie Original.
      \item $\{Y_t\}$ Serie del número de casos en periodos de cuatro semanas sucesivos.
    \end{itemize}
  \end{itemize}

  \section{Describir estas dos series ($\{Y_t\}$ puede crearse con el \texttt{proc expand} de \emph{SAS}), indicando claramente para cada una de ellas qué frecuencias elegiríais a priori para ajustar un modelo con tendencia polinómica más ondas.}
  \label{sec:a}


    \begin{figure}[h]
      \centering
      \includegraphics[width=.75\linewidth]{semanal}
      \caption{[TODO]}
      \label{fig:fitted}
    \end{figure}

    \paragraph{}
    [TODO]


    \begin{figure}[h]
      \centering
      \includegraphics[width=.75\linewidth]{semanal-diff}
      \caption{[TODO]}
      \label{fig:fitted}
    \end{figure}

    \paragraph{}
    [TODO]


    \begin{figure}[h]
      \centering
      \includegraphics[width=.75\linewidth]{semanal4}
      \caption{[TODO]}
      \label{fig:fitted}
    \end{figure}

    \paragraph{}
    [TODO]


    \begin{figure}[h]
      \centering
      \includegraphics[width=.75\linewidth]{semanal4-diff}
      \caption{[TODO]}
      \label{fig:fitted}
    \end{figure}

    \paragraph{}
    [TODO]

    \begin{figure}[h]
      \centering
      \inputminted{SAS}{./res/code/a-01-data.sas}
      \caption{[TODO]}
      \label{code:a_data}
    \end{figure}

    \paragraph{}
    [TODO]

    \begin{figure}[h]
      \centering
      \inputminted{SAS}{./res/code/a-02-expand.sas}
      \caption{[TODO]}
      \label{code:a_expand}
    \end{figure}

    \paragraph{}
    [TODO]

    \begin{figure}[h]
      \centering
      \inputminted{SAS}{./res/code/a-03-describe-x.sas}
      \caption{[TODO]}
      \label{code:a_describe_x}
    \end{figure}

    \paragraph{}
    [TODO]

    \begin{figure}[h]
      \centering
      \inputminted{SAS}{./res/code/a-03-describe-y.sas}
      \caption{[TODO]}
      \label{code:a_describe_y}
    \end{figure}

    \paragraph{}
    [TODO]

  \section{Ajustar por suavizado exponencial, con el \texttt{proc esm}, los tres modelos que se consideren más apropiados para la serie $\{Y_t\}$ y comprobar su adecuación.}
  \label{sec:b}

    \paragraph{}
    Tras realizar un exhaustivo análisis de todas las diferentes posibilidades de ajuste por suavizado exponencial elegimos el \textit{seasonal exponential smoothing}, el \textit{suavizado de Winters multiplicativo} y el \textit{aditivo}, ya que son los tres que incorporarán la estacionalidad de la serie.\\

    \subsection{Seasonal Exponential Smoothing}

      \paragraph{}
      Para comenzar explicaremos el modelo SES en el que mediante la tabla de los estimadores del parámetro y la significancia de dicho test.

      \begin{figure}[h]
        \centering
        \includegraphics[width=0.75\textwidth]{PvalorSeasonal}
        \caption{Tabla de significancia. Seasonal}
        \label{}
      \end{figure}

      \paragraph{}
      Observamos que para la constante de suavizado estacional no se rechaza su significancia a cualquier nivel ya que el pvalor es 0.99.

      \paragraph{}
      En cambio, si se rechazará para la constante de suavizado para la media, donde el pvalor es $<0.001$. Será conveniente diferenciar ya que el estimador estacional es cercano a 0. A continuación adjuntamos el gráfico del ACF de residuales:

      \begin{figure}[h]
        \centering
        \includegraphics[width=0.75\textwidth]{ErrorACFPlot_SEASONAL}
        \caption{Gráfica ACF Seasonal}
        \label{}
      \end{figure}

      \paragraph{}
      Observamos como dicho modelo ofrece dudas sobre su validación ya que para el retardo 2 la autocorrelación es muy alta. El retardo 1 no es muy alto, no resultará perjudicial para el modelo. Los retardos estacionales(cada 13) no son notables por lo que es bueno para la validación.

      \begin{figure}[h]
        \centering
        \includegraphics[width=0.75\textwidth]{ErrorWhiteNoiseLogProbPlot_SEASONAL}
        \caption{Probabilidad ruido blanco. Seasonal}
        \label{}
      \end{figure}

      \paragraph{}
      Vemos en la gráfica que el test de que las correlaciones sean cero se rechaza para los 4 primeros retardos a nivel 0.05. Esto es indeseable para validar el modelo puesto que no podemos asegurar que sea ruido blanco, que es lo que se busca.

      \paragraph{}
      A continuación, pasamos a realizar el ajuste del modelo aditivo de Winter.

    \subsection{Modelo aditivo de Winter}


      \begin{figure}[h]
        \centering
        \includegraphics[width=0.75\textwidth]{TablaADD}
        \caption{Tabla significancia. Aditivo}
        \label{}
      \end{figure}

      Observando la tabla, vemos que que tanto para la constante de suavizado para la tendencia como para la estacionalidad no son significativos, es decir, no se rechaza el test $\alpha_2$ y $\alpha_3$ igual a 0. Como el estimador $\alpha_2$ de es cercano a 0 y al existir estacionalidad significará que es conveniente diferenciar. Para $\alpha_3$ será que son indices estacionales deterministas.

      \begin{figure}[h]
        \centering
        \includegraphics[width=0.75\textwidth]{ACF_ADD}
        \caption{Plot ACF Aditivo. Aditivo}
        \label{}
      \end{figure}

      \paragraph{}
      Siguiendo la línea de lo comentado para el ACF del seasonal, vemos que para el retardo 2 de nuevo vuelve a ser una autocorrelación muy alta que indicará que solo se validará si no encontramos uno mejor. Para las autocorrelaciones para los periodos estacionales no se observa valores altos.

      \begin{figure}[h]
        \centering
        \includegraphics[width=0.75\textwidth]{WN_ADD}
        \caption{Plot WN Aditivo. Aditivo}
        \label{}
      \end{figure}

      \paragraph{}
      Siguiendo el análisis de este modelo para determinar si es un modelo con ruido blanco o no, vemos en dicha gráfica que de nuevo se rechaza para los primeros retardos y por tanto no será ruido blanco, algo indeseable para validar el modelo.

      \paragraph{}
      Por último analizaremos el modelo Winter multiplicativo.

    \subsection{Modelo multiplicativo de Winter}

      \paragraph{}
      Para comenzar se adjunta la tabla de significancia:

      \begin{figure}[h]
        \centering
        \includegraphics[width=0.75\textwidth]{TablaMUL}
        \caption{Tabla Significancia. Multiplicativo}
        \label{}
      \end{figure}

      \paragraph{}
      Observamos en la tabla anterior , que en este caso si se rechaza para la constante de suavizado estacional con un pvalor$ <0.001$ y para el nivel. Sin embargo, para la constantes de suavizado para la tendencia , no se rechaza la hipótesis de $\alpha_2 =0$, por lo que concluimos no será adecuado suavizar dicha componente. Vemos que su estimador es próximo a cero, por lo que será conveniente diferenciar o utilizar modelos ARIMA.

      \begin{figure}[h]
        \centering
        \includegraphics[width=0.75\textwidth]{ACF_MUL}
        \caption{Tabla PLOT ACF. Multiplicativo}
        \label{}
      \end{figure}

      \paragraph{}
      En el gráfico adjunto anteriormente, vemos como los primeros retardos son ligeramente menores a los de los otros modelos, donde en ningún caso sobrepasan las bandas. Los retardos para los periodos no son muy altos, quizás solo la autocorrelación 18 pero no es tan influyente en el ajuste.

      \begin{figure}[h]
        \centering
        \includegraphics[width=0.75\textwidth]{WN_MUL}
        \caption{WN.Mul}
        \label{}
      \end{figure}

      \paragraph{}
      Para finalizar, vemos el gráfico WN para contrastar si los residuales del modelo son ruido blanco. En este caso, diferenciandose ligeramente con los modelos anteriores, vemos que para $\alpha$ del 0.01 no se rechaza ninguno y solo 3 para $\alpha$ 0.05.

      \paragraph{}
      Por último compararemos SSE de cada modelo a modo de información adicional:

      \begin{figure}[h]
        \centering
        \includegraphics[width=0.75\textwidth]{SSE_SEASONAL}
        \caption{Tabla SSE.Seasonal}
        \label{}
      \end{figure}

      \begin{figure}[h]
        \centering
        \includegraphics[width=0.75\textwidth]{SSE_ADD}
        \caption{Tabla SSE.ADD}
        \label{}
      \end{figure}

      \begin{figure}[h]
        \centering
        \includegraphics[width=0.75\textwidth]{SSE_MUL}
        \caption{Tabla SSE.MUL}
        \label{}
      \end{figure}


    \paragraph{}
    [TODO]

    \begin{figure}[h]
      \centering
      \inputminted{SAS}{./res/code/b-01-esm-1.sas}
      \caption{[TODO]}
      \label{code:b_esm_1}
    \end{figure}

    \paragraph{}
    [TODO]

    \begin{figure}[h]
      \centering
      \inputminted{SAS}{./res/code/b-01-esm-2.sas}
      \caption{[TODO]}
      \label{code:b_esm_2}
    \end{figure}

    \paragraph{}
    [TODO]

    \begin{figure}[h]
      \centering
      \inputminted{SAS}{./res/code/b-01-esm-3.sas}
      \caption{[TODO]}
      \label{code:b_esm_3}
    \end{figure}

    \paragraph{}
    [TODO]


  \section{Elegir el modelo que se considere más apropiado entre los tres del apartado \ref{sec:b} y con ese modelo dar las predicciones para las próximas $6$ observaciones. Justificar la elección del modelo.}
  \label{sec:c}

    \paragraph{}
    [TODO]

    \begin{figure}[h]
      \centering
      \inputminted{SAS}{./res/code/c-01-prediction.sas}
      \caption{[TODO]}
      \label{code:c_prediction}
    \end{figure}

    \paragraph{}
    [TODO]

  \section{Utilizando en el ajuste solamente los datos hasta el final de $1990$ que no incluyan ningún caso de $1991$, calcular los errores de predicción para el año $1991$ y su correspondiente $SSE_p$ (suma de $s$ errores al cuadrado correspondientes a predicciones $\{1, 2, ..., s\}$ pasos hacia adelante) para los tres modelos del apartado \ref{sec:b}. Comentar si la elección hecha en el apartado \ref{sec:c} está de acuerdo con los resultados obtenidos en este caso al comparar la capacidad de predicción de los distintos modelos para el año $1991$. Adjuntad el programa con el lenguaje control que hayáis utilizado en este apartado.}
  \label{sec:d}

    \paragraph{}
    [TODO]

    \begin{figure}[h]
      \centering
      \inputminted{SAS}{./res/code/d-01-prediction-error-esm-1.sas}
      \caption{[TODO]}
      \label{code:d_prediction_error_esm_1}
    \end{figure}

    \paragraph{}
    [TODO]

    \begin{figure}[h]
      \centering
      \inputminted{SAS}{./res/code/d-01-prediction-error-esm-2.sas}
      \caption{[TODO]}
      \label{code:d_prediction_error_esm_2}
    \end{figure}

    \paragraph{}
    [TODO]

    \begin{figure}[h]
      \centering
      \inputminted{SAS}{./res/code/d-01-prediction-error-esm-3.sas}
      \caption{[TODO]}
      \label{code:d_prediction_error_esm_3}
    \end{figure}

    \paragraph{}
    [TODO]


  \section{Obtener con el \texttt{proc forecast} de \emph{SAS} el $SSE_p$ para el modelo de \emph{Winter Multiplicativo} con las mismas constantes de suavizado y los valores iniciales de los parámetros lo más próximos posible a los obtenidos en el apartado \ref{sec:d} con el \texttt{proc esm} para este modelo. Adjuntar el programa con el lenguaje control que hayáis utilizado para obtenerlo.}
  \label{sec:e}

    \paragraph{}
    [TODO]

    \begin{figure}[h]
      \centering
      \inputminted{SAS}{./res/code/e-01-prediction-error-forecast-1.sas}
      \caption{[TODO]}
      \label{code:e_prediction_error_forecast_1}
    \end{figure}

    \paragraph{}
    [TODO]

    \begin{figure}[h]
      \centering
      \inputminted{SAS}{./res/code/e-01-prediction-error-forecast-2.sas}
      \caption{[TODO]}
      \label{code:e_prediction_error_forecast_2}
    \end{figure}

    \paragraph{}
    [TODO]

    \begin{figure}[h]
      \centering
      \inputminted{SAS}{./res/code/e-01-prediction-error-forecast-3.sas}
      \caption{[TODO]}
      \label{code:e_prediction_error_forecast_3}
    \end{figure}

    \paragraph{}
    [TODO]


  \section{Ajustar un modelo para la serie $\{ Xt \}$ con el módulo \texttt{Time Series Forecasting System} de \emph{SAS} razonando porqué se ha elegido. Utilizar el modelo elegido para predecir valores futuros de esta serie y establecer la comparación con los seis valores obtenidos en el apartado \ref{sec:c} junto con sus bandas de predicción.}
  \label{sec:f}

    \paragraph{}
    [TODO]


\end{document}
